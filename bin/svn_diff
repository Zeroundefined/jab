#! /bin/bash

atexit ()
{
	rm -f "$COPY_OF_CHECKOUT"
}

main ()
{
	local direction=$1
	local path_to_file=$2
	local revision=
	if [[ -n $3 ]]
	then revision="$3"
	else revision=$(svn info $path_to_file | pyp "'Last Changed Rev' in p | colon[1].strip()")
	fi

	local options="-O"
	[[ "$direction" == "horizontal" ]] && options="-o"

	COPY_OF_CHECKOUT=${path_to_file}.svn_checkout.r$revision

	svn cat -r $revision "$path_to_file" > "$COPY_OF_CHECKOUT"
	vim -d $options "$path_to_file" "$COPY_OF_CHECKOUT"
}

# set -x
trap atexit EXIT
main $*
# set +x

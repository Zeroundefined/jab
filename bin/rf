#! /bin/bash

usage ()
{
	echo "$BASH_SOURCE [options] [directory]"
	echo
	echo "Remove files known to be temporary:"
	echo "	*~ .*~ *.orig fred* mary *.tmp *.bak one two a.out"
	echo
	echo "current directory is default ($PWD)"
	echo
	echo options:
	echo "	-p	also remove *.py[co] *.fail"
	echo "	-q	quietly"
	echo "	-r	recursively"
	exit
}

set_symbols ()
{
	. ~/.jab/bin/first_dir
	first_dir $*
	FIND_OPTIONS="-maxdepth 1"
	RM_OPTIONS=-vrf
	GLOBS="*~ .*~ *.orig fred* mary *.tmp *.bak one two a.out"
	while getopts "hpqr" option
	do
		case $option in 
		h) usage
			;;
		p) GLOBS="$GLOBS *.py[co] *.fail"
			;;
		q) RM_OPTIONS=-rf
			;;
		r) FIND_OPTIONS=
			;;
		esac
	done
}

clean_temporary_files ()
{
	back=$(pwd)
	if [[ -f $dir/clean ]]
	then
		builtin cd $dir
		bash clean
	fi
	for GLOB in $GLOBS
	do
		find $dir $FIND_OPTIONS \( -type d -a -name .svn -prune \) -o -name "$GLOB" -exec rm $RM_OPTIONS {} \;
	done
	builtin cd $back
}

main ()
{
	set_symbols $*
	clean_temporary_files
}

# set -x
main $*
# set +x
